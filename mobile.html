<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üì¶ Warehouse QR Check</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>

<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  color: #1e293b;
  padding: 20px;
  min-height: 100vh;
}
.header {
  position: fixed; top: 0; left: 0; width: 100%;
  background: #1e3a8a; color: white;
  text-align: center; padding: 14px 0;
  font-weight: 600; font-size: 18px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  z-index: 100;
}
.container {
  margin-top: 80px; background: white;
  border-radius: 12px; padding: 24px;
  max-width: 480px; margin-inline: auto;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.compact-row { display: flex; justify-content: center; gap: 54px; margin-bottom: 16px; }
.compact-row > div { width: 60%; display: flex; flex-direction: column; }
.compact-row label { font-weight: 600; margin-bottom: 4px; font-size: 13.5px; }
.compact-row input {
  width: 100%; padding: 5px 6px; font-size: 13.5px;
  border: 1.5px solid #cbd5e1; border-radius: 6px; height: 30px;
}
.form-row { display: flex; flex-direction: column; margin-bottom: 14px; }
.form-row label { font-weight: 600; margin-bottom: 4px; font-size: 14px; }
.form-row input {
  width: 100%; padding: 5px 6px; font-size: 14px;
  border: 1.5px solid #cbd5e1; border-radius: 6px; height: 32px;
}
.readonly { background: #f1f5f9; }
.btn {
  border: none; border-radius: 8px; padding: 12px;
  font-weight: 600; color: white; background: #2563eb;
  width: 100%; cursor: pointer; font-size: 17px;
}
.btn:hover { background: #1d4ed8; }
.btn-scan {
  background: #059669; color: white; width: 100%;
  font-size: 18px; padding: 14px; border-radius: 10px;
  font-weight: 600; display: flex; align-items: center;
  justify-content: center; gap: 10px; border: 1.5px solid #047857;
}
.btn-scan svg { width: 22px; height: 22px; fill: white; }
.btn-scan:hover { background: #047857; }
hr { border: none; border-top: 1px solid #e2e8f0; margin: 20px 0; }

/* Package layout */
.package-box { display: flex; align-items: center; justify-content: center; gap: 6px; }
.pkg-input {
  text-align: center;
  font-size: 13.5px;
  border: 1.5px solid #cbd5e1;
  border-radius: 6px;
  height: 30px;
  padding: 2px;
}
.pkg-input.a, .pkg-input.b, .pkg-input.c { width: 45px; }

/* Button Row */
.button-row {
  display: flex;
  gap: 8px;
  margin-top: 15px;
}
.btn-add {
  width: 30%;
  background: #10b981;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 20px;
  color: white;
  cursor: pointer;
}
.btn-add:hover { background: #059669; }
.btn-save { width: 70%; }

/* Delete button */
.btn-delete {
  position: absolute; top: 0; right: 0;
  background: #ef4444; color: white;
  border: none; border-radius: 0 8px 0 8px;
  padding: 4px 10px; font-weight: bold;
  cursor: pointer; font-size: 14px;
}
.btn-delete:hover { background: #dc2626; }

.rack-set {
  position: relative;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}

/* Scanner Overlay */
#scanner-view {
  display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: #000; z-index: 200;
}
#scanner-container {
  width: 100%; height: 100%; position: relative;
  display: flex; justify-content: center; align-items: center;
}
video { object-fit: cover; width: 100%; height: 100%; }
.scan-box {
  position: absolute; width: 260px; height: 260px;
  border: 3px solid #00ff00; border-radius: 10px;
  box-shadow: 0 0 0 4000px rgba(0,0,0,0.6);
}
.btn-close {
  position: absolute; bottom: 30px; left: 50%;
  transform: translateX(-50%);
  background: #ef4444; border: none;
  border-radius: 50%; color: white;
  width: 60px; height: 60px; font-size: 28px;
}
.scan-text {
  position: absolute; bottom: 15%; width: 100%;
  text-align: center; color: #00ff00; font-size: 17px; font-weight: 600;
}
</style>
</head>

<body>
<div class="header">üì¶ RMT Warehouse Check Stock</div>

<div class="container" id="main-view">
  <button class="btn-scan" onclick="startScanner()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M3 3h8v8H3V3m2 2v4h4V5H5m6 6h2v2h-2v-2m0 4h2v2h-2v-2m4-4h2v2h-2v-2m0 4h2v2h-2v-2m-4 4h2v2h-2v-2m4 0h2v2h-2v-2M3 13h8v8H3v-8m2 2v4h4v-4H5m10-12h6v6h-6V3m2 2v2h2V5h-2m0 4h2v2h-2V9m0 4h6v6h-6v-6m2 2v2h2v-2h-2Z" />
    </svg> Scan QR
  </button>

  <hr>

  <div class="compact-row">
    <div><label>Customer</label><input id="customer" class="readonly" readonly></div>
    <div><label>File</label><input id="file" class="readonly" readonly></div>
  </div>

  <div class="compact-row">
    <div><label>Lot</label><input id="lot" class="readonly" readonly></div>
    <div><label>Q'ty</label><input id="sumQty" class="readonly" readonly></div>
  </div>

  <div class="form-row"><label>Rack</label><input id="rack" class="readonly" readonly></div>
  <div class="form-row"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à</label><input id="scannerName" class="readonly" readonly></div>

  <hr>

  <div id="rackZone">
    <div class="rack-set">
      <button class="btn-delete" onclick="removeRackSet(this)">üóëÔ∏è</button>
      <div class="form-row"><label>Act Rack</label><input class="actRack" placeholder="‡πÄ‡∏ä‡πà‡∏ô R01-A"></div>
      <div class="compact-row">
        <div>
          <label>Package</label>
          <div class="package-box">
            <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input a" oninput="validateNumber(this)">
            √ó
            <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input b" oninput="validateNumber(this)">
            +
            <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input c" oninput="validateNumber(this)">
          </div>
        </div>
        <div>
          <label>Act Q'ty</label>
          <input class="actQty readonly" readonly>
        </div>
      </div>
    </div>
  </div>

  <div class="button-row">
    <button class="btn-add" onclick="addRackSet()">Ôºã</button>
    <button class="btn btn-save" onclick="submitData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <p style="text-align:center;margin-top:12px;font-size:12px;color:#64748b;">
    ¬© 2025 Resonac Materials (Thailand) Co., Ltd.
  </p>
</div>

<!-- Scanner View -->
<div id="scanner-view">
  <div id="scanner-container"></div>
  <div class="scan-box"></div>
  <div class="scan-text">üì± ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR Code...</div>
  <button class="btn-close" onclick="stopScanner()">‚úï</button>
</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let codeReader;

async function startScanner() {
  document.getElementById("main-view").style.display = "none";
  document.getElementById("scanner-view").style.display = "block";

  codeReader = new ZXing.BrowserMultiFormatReader();
  const videoElem = document.createElement("video");
  videoElem.setAttribute("playsinline", true);
  videoElem.style.width = "100%";
  videoElem.style.height = "100%";
  document.getElementById("scanner-container").appendChild(videoElem);

  try {
    await codeReader.decodeFromVideoDevice(null, videoElem, (result, err) => {
      if (result) {
        const text = result.text.trim();
        document.getElementById("beep").play();
        stopScanner();
        handleQRData(text);
      }
    });
  } catch (e) {
    Swal.fire("‚ùå", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ", "error");
    stopScanner();
  }
}

function stopScanner() {
  if (codeReader) codeReader.reset();
  document.getElementById("scanner-container").innerHTML = "";
  document.getElementById("scanner-view").style.display = "none";
  document.getElementById("main-view").style.display = "block";
}

function handleQRData(text) {
  const parts = text.split("/");
  customer.value = parts[0] || "";
  scannerName.value = parts[1] || "";
  file.value = parts[2] || "";
  lot.value = parts[3] || "";
  rack.value = parts[4] || "";
  sumQty.value = parts[5] || "";
}

function bindPackageEvents(container) {
  const inputs = container.querySelectorAll(".pkg-input");
  inputs.forEach(input => {
    input.addEventListener("input", () => {
      validateNumber(input);
      const a = +container.querySelector(".pkg-input.a").value || 0;
      const b = +container.querySelector(".pkg-input.b").value || 0;
      const c = +container.querySelector(".pkg-input.c").value || 0;
      container.querySelector(".actQty").value = (a * b) + c;
    });
  });
}

function addRackSet() {
  const zone = document.getElementById("rackZone");
  const newSet = document.createElement("div");
  newSet.className = "rack-set";
  newSet.innerHTML = `
    <button class="btn-delete" onclick="removeRackSet(this)">üóëÔ∏è</button>
    <div class="form-row"><label>Act Rack</label><input class="actRack" placeholder="‡πÄ‡∏ä‡πà‡∏ô R01-A"></div>
    <div class="compact-row">
      <div>
        <label>Package</label>
        <div class="package-box">
          <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input a" oninput="validateNumber(this)">
          √ó
          <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input b" oninput="validateNumber(this)">
          +
          <input type="number" inputmode="numeric" pattern="[0-9]*" class="pkg-input c" oninput="validateNumber(this)">
        </div>
      </div>
      <div>
        <label>Act Q'ty</label>
        <input class="actQty readonly" readonly>
      </div>
    </div>
  `;
  zone.appendChild(newSet);
  bindPackageEvents(newSet);
}

function removeRackSet(btn) {
  btn.closest(".rack-set").remove();
}

document.addEventListener("DOMContentLoaded", () => {
  bindPackageEvents(document.querySelector(".rack-set"));
});

function validateNumber(input) {
  input.value = input.value.replace(/[^0-9]/g, "");
}
</script>
</body>
</html>
